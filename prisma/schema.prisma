// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// User Management
model User {
  id        String   @id @default(cuid())
  email     String   @unique
  name      String?
  password  String
  role      UserRole @default(STAFF)
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  transactions Transaction[]

  @@map("users")
}

enum UserRole {
  OWNER
  MANAGER
  STAFF
}

// Product Management
model Category {
  id          String    @id @default(cuid())
  name        String    @unique
  description String?
  isActive    Boolean   @default(true)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  // Relations
  products Product[]

  @@map("categories")
}

model Brand {
  id        String   @id @default(cuid())
  name      String   @unique
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  products Product[]

  @@map("brands")
}

model Size {
  id        String   @id @default(cuid())
  name      String   @unique // XS, S, M, L, XL, etc
  sortOrder Int      @default(0)
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  productVariants ProductVariant[]

  @@map("sizes")
}

model Color {
  id        String   @id @default(cuid())
  name      String   @unique
  hexCode   String?  // Color hex code
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  productVariants ProductVariant[]

  @@map("colors")
}

model Product {
  id          String      @id @default(cuid())
  name        String
  sku         String      @unique
  description String?
  season      Season?
  gender      Gender?
  categoryId  String
  brandId     String
  costPrice   Decimal     @db.Decimal(10, 2)
  sellingPrice Decimal    @db.Decimal(10, 2)
  isActive    Boolean     @default(true)
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt

  // Relations
  category Category @relation(fields: [categoryId], references: [id])
  brand    Brand    @relation(fields: [brandId], references: [id])
  variants ProductVariant[]
  transactionItems TransactionItem[]

  @@map("products")
}

enum Season {
  SPRING_SUMMER
  FALL_WINTER
  ALL_SEASON
}

enum Gender {
  MALE
  FEMALE
  UNISEX
  KIDS
}

model ProductVariant {
  id        String   @id @default(cuid())
  productId String
  sizeId    String
  colorId   String
  barcode   String?  @unique
  stock     Int      @default(0)
  minStock  Int      @default(5)
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)
  size    Size    @relation(fields: [sizeId], references: [id])
  color   Color   @relation(fields: [colorId], references: [id])
  stockMovements StockMovement[]
  transactionItems TransactionItem[]

  @@unique([productId, sizeId, colorId])
  @@map("product_variants")
}

// Stock Management
model StockMovement {
  id        String            @id @default(cuid())
  variantId String
  type      StockMovementType
  quantity  Int
  reason    String?
  reference String? // Reference to transaction, adjustment, etc
  createdAt DateTime          @default(now())
  createdBy String?

  // Relations
  variant ProductVariant @relation(fields: [variantId], references: [id])

  @@map("stock_movements")
}

enum StockMovementType {
  IN
  OUT
  ADJUSTMENT
}

// Supplier Management
model Supplier {
  id          String   @id @default(cuid())
  name        String
  contact     String?
  phone       String?
  email       String?
  address     String?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  transactions Transaction[]

  @@map("suppliers")
}

// Transaction Management
model Transaction {
  id            String          @id @default(cuid())
  type          TransactionType
  invoiceNumber String          @unique
  supplierId    String?
  userId        String
  totalAmount   Decimal         @db.Decimal(12, 2)
  notes         String?
  status        TransactionStatus @default(COMPLETED)
  transactionDate DateTime      @default(now())
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt

  // Relations
  supplier Supplier? @relation(fields: [supplierId], references: [id])
  user     User      @relation(fields: [userId], references: [id])
  items    TransactionItem[]

  @@map("transactions")
}

enum TransactionType {
  SALE
  PURCHASE
  RETURN_SALE
  RETURN_PURCHASE
  ADJUSTMENT
}

enum TransactionStatus {
  PENDING
  COMPLETED
  CANCELLED
}

model TransactionItem {
  id            String  @id @default(cuid())
  transactionId String
  productId     String
  variantId     String?
  quantity      Int
  unitPrice     Decimal @db.Decimal(10, 2)
  totalPrice    Decimal @db.Decimal(10, 2)

  // Relations
  transaction Transaction    @relation(fields: [transactionId], references: [id], onDelete: Cascade)
  product     Product        @relation(fields: [productId], references: [id])
  variant     ProductVariant? @relation(fields: [variantId], references: [id])

  @@map("transaction_items")
}

// Store Settings
model StoreSetting {
  id    String @id @default(cuid())
  key   String @unique
  value String
  
  @@map("store_settings")
}
